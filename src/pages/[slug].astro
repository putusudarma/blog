---
import fs from "fs";
import path from "path";
import matter from "gray-matter";

export async function getStaticPaths() {
  const postsDir = path.resolve("src/content/posts");
  const files = fs.readdirSync(postsDir);

  return files
    .filter(file => file.endsWith(".html"))
    .map(file => ({
      params: { slug: file.replace(".html", "") }
    }));
}

const postsDir = path.resolve("src/content/posts");

const { slug } = Astro.params;
const filePath = path.join(postsDir, `${slug}.html`);

if (!fs.existsSync(filePath)) {
  throw new Error("Post not found");
}

const raw = fs.readFileSync(filePath, "utf-8");
const { data, content } = matter(raw);
---

<html>
  <head>
    <title>{data.title}</title>
  </head>
  <body>

    <article>
      <h1>{data.title}</h1>
      <small>{data.date}</small>

      <div set:html={content}></div>
    </article>

  </body>
</html>
