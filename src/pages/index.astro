---
import fs from "fs";
import path from "path";
import matter from "gray-matter";

const postsDir = path.resolve("src/content/posts");

const files = fs.readdirSync(postsDir);

const posts = files
  .filter(file => file.endsWith(".html"))
  .map(file => {
    const raw = fs.readFileSync(path.join(postsDir, file), "utf-8");
    const { data } = matter(raw);

    return {
      slug: file.replace(".html", ""),
      ...data
    };
  })
  .filter(post => !post.draft)
  .sort((a,b)=> new Date(b.date)-new Date(a.date));
---

<html>
  <body>
    <h1>My Blog</h1>

    <ul>
      {posts.map(post => (
        <li>
          <a href={`/${post.slug}/`}>
            {post.title}
          </a>
          - {post.date}
        </li>
      ))}
    </ul>

  </body>
</html>
